<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tobias">
<meta name="dcterms.date" content="2023-02-08">

<title>Tobias Anton - sugr: data preparation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Tobias Anton</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects.html">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../packages.html">
 <span class="menu-text">R Packages</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/marauderpixie"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://norden.social/@marauderpixie"><i class="bi bi-mastodon" role="img" aria-label="Mastodon">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:tobanton@uni-osnabrueck.de"><i class="bi bi-envelope-fill" role="img" aria-label="E-Mail">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">sugr: data preparation</h1>
            <p class="subtitle lead">Preparation of Continouos Glucose Measurements for usage in a shiny app</p>
                                <div class="quarto-categories">
                <div class="quarto-category">data cleaning</div>
                <div class="quarto-category">timeseries</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tobias </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 8, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#reading-the-raw-data" id="toc-reading-the-raw-data" class="nav-link" data-scroll-target="#reading-the-raw-data">Reading the Raw Data</a></li>
  <li><a href="#the-clean-up-procedure" id="toc-the-clean-up-procedure" class="nav-link" data-scroll-target="#the-clean-up-procedure">The Clean-up Procedure</a>
  <ul class="collapse">
  <li><a href="#codebook" id="toc-codebook" class="nav-link" data-scroll-target="#codebook">Codebook</a></li>
  <li><a href="#cleaning-and-variable-selection" id="toc-cleaning-and-variable-selection" class="nav-link" data-scroll-target="#cleaning-and-variable-selection">Cleaning and Variable Selection</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap-Up</a></li>
  </ul></li>
  <li><a href="#splitting-cgm-pump-data" id="toc-splitting-cgm-pump-data" class="nav-link" data-scroll-target="#splitting-cgm-pump-data">Splitting CGM &amp; Pump Data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<div class="tldr">
<p><strong>tl;dr:</strong> CGMs are a great source of (timeseries) data to tinker with. Here I describe the process of cleaning up and preparing the data of Medtronics systems in order to use it in a shiny app.</p>
</div>
<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>I’m a type I diabetic and therefore use an insulin pump and a connected CGM - continouos glucose measurement - system from Medtronic. The company kindly provides access to the raw data, even though only by the use of propriatory software and a web interface. This means I can’t access the data through some sort of API to automate the collection thereof and have to run through that process manually on a regular basis.</p>
<p>Apart from that minor nuisance what’s more important though is the fact that the data needs some touch-ups before you can actually use them:</p>
<ul>
<li>data from the pump and the GCM sensor are basically two different datasets but kept in the same csv</li>
<li>while the time interval is 5 minutes (a reading from the GCM), not much else is going on otherwise</li>
<li>direct blood glucose measurements, insulin doses, etc. are delivered <em>whenever</em> and not on-point of the 5min intervals</li>
</ul>
<p>Here I’ll walk through the process of cleaning that up.</p>
</section>
<section id="reading-the-raw-data" class="level1">
<h1>Reading the Raw Data</h1>
<p>First let’s have a look at what we’ve got here. To save ourselves some headaches, I already put all the settings in all the places such that we get a nice tabular dataset. Most should be pretty self-explanatory: entries are delimited by a semicolon, the date format has to be sepcified and so on. I set <code>skip = 6</code> because, well, that’s where the actual csv entries actually begin. Beforehand it’s just some unstructured data about the device, patient, date of recordng, etc.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Glimpse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Warning</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data_raw <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/sugr/carelink-export-220217.csv"</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">delim =</span> <span class="st">";"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">Date =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">"%Y/%m/%d"</span>), </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Time =</span> <span class="fu">col_time</span>(<span class="at">format =</span> <span class="st">"%H:%M:%S"</span>)), </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>), </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">trim_ws =</span> <span class="cn">TRUE</span>, <span class="at">skip =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...51`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 9,236
Columns: 51
$ Index                                 &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10…
$ Date                                  &lt;date&gt; 2022-02-17, 2022-02-17, 2022-02…
$ Time                                  &lt;time&gt; 11:07:38, 11:02:39, 11:00:00, 1…
$ `New Device Time`                     &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BG Source`                           &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BG Reading (mg/dL)`                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Linked BG Meter ID`                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Basal Rate (U/h)`                    &lt;dbl&gt; NA, NA, 0.65, NA, NA, NA, NA, NA…
$ `Temp Basal Amount`                   &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Temp Basal Type`                     &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Temp Basal Duration (h:mm:ss)`       &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Bolus Type`                          &lt;chr&gt; "Normal", "Normal", NA, "Normal"…
$ `Bolus Volume Selected (U)`           &lt;dbl&gt; 0.03, 0.05, NA, 0.05, 0.03, 0.03…
$ `Bolus Volume Delivered (U)`          &lt;dbl&gt; 0.03, 0.05, NA, 0.05, 0.03, 0.03…
$ `Bolus Duration (h:mm:ss)`            &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Prime Type`                          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Prime Volume Delivered (U)`          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ Alarm                                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ Suspend                               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ Rewind                                &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Estimate (U)`                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Target High BG (mg/dL)`          &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Target Low BG (mg/dL)`           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Carb Ratio (g/U)`                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Insulin Sensitivity (mg/dL/U)`   &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Carb Input (grams)`              &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ BG Input (mg/dL)`                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Correction Estimate (U)`         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Food Estimate (U)`               &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Active Insulin (U)`              &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Status`                          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Sensor Calibration BG (mg/dL)`       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Sensor Glucose (mg/dL)`              &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `ISIG Value`                          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Event Marker`                        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Bolus Number`                        &lt;dbl&gt; 236, 235, NA, 234, 233, 232, 231…
$ `Bolus Cancellation Reason`           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `BWZ Unabsorbed Insulin Total (U)`    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Final Bolus Estimate`                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Scroll Step Size`                    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Insulin Action Curve Time`           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Sensor Calibration Rejected Reason`  &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Preset Bolus`                        &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Bolus Source`                        &lt;chr&gt; "CLOSED_LOOP_MICRO_BOLUS", "CLOS…
$ `BLE Network Device`                  &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Network Device Associated Reason`    &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Network Device Disassociated Reason` &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Network Device Disconnected Reason`  &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Sensor Exception`                    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ `Preset Temp Basal Name`              &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …
$ ...51                                 &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">problems</span>(data_raw) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>file) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">120</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 112 × 4
      row   col expected           actual                             
    &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                              
  1   115    41 1/0/T/F/TRUE/FALSE 240                                
  2   493    22 1/0/T/F/TRUE/FALSE 120                                
  3   493    23 1/0/T/F/TRUE/FALSE 90                                 
  4   493    25 1/0/T/F/TRUE/FALSE 40                                 
  5   493    30 1/0/T/F/TRUE/FALSE 2,10                               
  6   505    22 1/0/T/F/TRUE/FALSE 120                                
  7   505    23 1/0/T/F/TRUE/FALSE 90                                 
  8   505    25 1/0/T/F/TRUE/FALSE 40                                 
  9   505    30 1/0/T/F/TRUE/FALSE 0,0                                
 10   922    22 1/0/T/F/TRUE/FALSE 120                                
 11   922    23 1/0/T/F/TRUE/FALSE 90                                 
 12   922    25 1/0/T/F/TRUE/FALSE 40                                 
 13   922    30 1/0/T/F/TRUE/FALSE 0,20                               
 14   933    22 1/0/T/F/TRUE/FALSE 160                                
 15   933    23 1/0/T/F/TRUE/FALSE 120                                
 16   933    25 1/0/T/F/TRUE/FALSE 40                                 
 17   933    30 1/0/T/F/TRUE/FALSE 4,20                               
 18   937    22 1/0/T/F/TRUE/FALSE 160                                
 19   937    23 1/0/T/F/TRUE/FALSE 120                                
 20   937    25 1/0/T/F/TRUE/FALSE 40                                 
 21   937    30 1/0/T/F/TRUE/FALSE 3,10                               
 22   944    22 1/0/T/F/TRUE/FALSE 160                                
 23   944    23 1/0/T/F/TRUE/FALSE 120                                
 24   944    25 1/0/T/F/TRUE/FALSE 40                                 
 25   944    30 1/0/T/F/TRUE/FALSE 2,40                               
 26   955    22 1/0/T/F/TRUE/FALSE 120                                
 27   955    23 1/0/T/F/TRUE/FALSE 90                                 
 28   955    25 1/0/T/F/TRUE/FALSE 40                                 
 29   955    30 1/0/T/F/TRUE/FALSE 0,20                               
 30   981    48 1/0/T/F/TRUE/FALSE USER_INITIATED                     
 31  1002    22 1/0/T/F/TRUE/FALSE 120                                
 32  1002    23 1/0/T/F/TRUE/FALSE 90                                 
 33  1002    25 1/0/T/F/TRUE/FALSE 40                                 
 34  1002    30 1/0/T/F/TRUE/FALSE 0,0                                
 35  1417    20 1/0/T/F/TRUE/FALSE Rewind                             
 36  2715    22 1/0/T/F/TRUE/FALSE 120                                
 37  2715    23 1/0/T/F/TRUE/FALSE 90                                 
 38  2715    25 1/0/T/F/TRUE/FALSE 40                                 
 39  2715    30 1/0/T/F/TRUE/FALSE 1,30                               
 40  2726    22 1/0/T/F/TRUE/FALSE 120                                
 41  2726    23 1/0/T/F/TRUE/FALSE 90                                 
 42  2726    25 1/0/T/F/TRUE/FALSE 40                                 
 43  2726    30 1/0/T/F/TRUE/FALSE 0,0                                
 44  2746    22 1/0/T/F/TRUE/FALSE 140                                
 45  2746    23 1/0/T/F/TRUE/FALSE 90                                 
 46  2746    25 1/0/T/F/TRUE/FALSE 40                                 
 47  2746    30 1/0/T/F/TRUE/FALSE 0,80                               
 48  2760    22 1/0/T/F/TRUE/FALSE 120                                
 49  2760    23 1/0/T/F/TRUE/FALSE 90                                 
 50  2760    25 1/0/T/F/TRUE/FALSE 40                                 
 51  2760    30 1/0/T/F/TRUE/FALSE 5,10                               
 52  2762    22 1/0/T/F/TRUE/FALSE 120                                
 53  2762    23 1/0/T/F/TRUE/FALSE 90                                 
 54  2762    25 1/0/T/F/TRUE/FALSE 40                                 
 55  2762    30 1/0/T/F/TRUE/FALSE 5,10                               
 56  2768    22 1/0/T/F/TRUE/FALSE 140                                
 57  2768    23 1/0/T/F/TRUE/FALSE 90                                 
 58  2768    25 1/0/T/F/TRUE/FALSE 40                                 
 59  2768    30 1/0/T/F/TRUE/FALSE 4,80                               
 60  2772    22 1/0/T/F/TRUE/FALSE 140                                
 61  2772    23 1/0/T/F/TRUE/FALSE 90                                 
 62  2772    25 1/0/T/F/TRUE/FALSE 40                                 
 63  2772    30 1/0/T/F/TRUE/FALSE 0,0                                
 64  2779    48 1/0/T/F/TRUE/FALSE USER_INITIATED                     
 65  2955    37 1/0/T/F/TRUE/FALSE User Request                       
 66  3286    20 1/0/T/F/TRUE/FALSE Rewind                             
 67  3321    37 1/0/T/F/TRUE/FALSE User Request                       
 68  3806    37 1/0/T/F/TRUE/FALSE User Request                       
 69  4338     1 a double           -------                            
 70  4338     2 date like %Y/%m/%d MiniMed 670G MMT-1781              
 71  4338     3 time like %H:%M:%S Sensor                             
 72  4338     4 1/0/T/F/TRUE/FALSE NG2307024H                         
 73  4338     5 51 columns         5 columns                          
 74  4339     1 a double           Index                              
 75  4339     2 date like %Y/%m/%d Date                               
 76  4339     3 time like %H:%M:%S Time                               
 77  4339     4 1/0/T/F/TRUE/FALSE New Device Time                    
 78  4339     6 a double           BG Reading (mg/dL)                 
 79  4339     8 a double           Basal Rate (U/h)                   
 80  4339     9 1/0/T/F/TRUE/FALSE Temp Basal Amount                  
 81  4339    10 1/0/T/F/TRUE/FALSE Temp Basal Type                    
 82  4339    11 1/0/T/F/TRUE/FALSE Temp Basal Duration (h:mm:ss)      
 83  4339    13 a double           Bolus Volume Selected (U)          
 84  4339    14 a double           Bolus Volume Delivered (U)         
 85  4339    15 1/0/T/F/TRUE/FALSE Bolus Duration (h:mm:ss)           
 86  4339    17 a double           Prime Volume Delivered (U)         
 87  4339    20 1/0/T/F/TRUE/FALSE Rewind                             
 88  4339    21 a double           BWZ Estimate (U)                   
 89  4339    22 1/0/T/F/TRUE/FALSE BWZ Target High BG (mg/dL)         
 90  4339    23 1/0/T/F/TRUE/FALSE BWZ Target Low BG (mg/dL)          
 91  4339    24 a double           BWZ Carb Ratio (g/U)               
 92  4339    25 1/0/T/F/TRUE/FALSE BWZ Insulin Sensitivity (mg/dL/U)  
 93  4339    26 a double           BWZ Carb Input (grams)             
 94  4339    27 a double           BWZ BG Input (mg/dL)               
 95  4339    28 a double           BWZ Correction Estimate (U)        
 96  4339    29 a double           BWZ Food Estimate (U)              
 97  4339    30 1/0/T/F/TRUE/FALSE BWZ Active Insulin (U)             
 98  4339    32 a double           Sensor Calibration BG (mg/dL)      
 99  4339    33 a double           Sensor Glucose (mg/dL)             
100  4339    34 a double           ISIG Value                         
101  4339    36 a double           Bolus Number                       
102  4339    37 1/0/T/F/TRUE/FALSE Bolus Cancellation Reason          
103  4339    38 a double           BWZ Unabsorbed Insulin Total (U)   
104  4339    39 a double           Final Bolus Estimate               
105  4339    41 1/0/T/F/TRUE/FALSE Insulin Action Curve Time          
106  4339    42 1/0/T/F/TRUE/FALSE Sensor Calibration Rejected Reason 
107  4339    43 1/0/T/F/TRUE/FALSE Preset Bolus                       
108  4339    45 1/0/T/F/TRUE/FALSE BLE Network Device                 
109  4339    46 1/0/T/F/TRUE/FALSE Network Device Associated Reason   
110  4339    47 1/0/T/F/TRUE/FALSE Network Device Disassociated Reason
111  4339    48 1/0/T/F/TRUE/FALSE Network Device Disconnected Reason 
112  4339    50 1/0/T/F/TRUE/FALSE Preset Temp Basal Name             </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Okay, so, a <strong>Warning</strong>. What’s that about?</p>
<p>Alright, the first ~70ish are actual parsing errors that lead to empty cells. Not great, but also no entries of huge importance<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, as far as I can tell. The rest though result from the circumstance that the file is basically seperated in CGM sensor data and insulin pump data, as mentioned in the beginning. Luckily though, <code>readr</code>/<code>vroom</code> just ignores the two rows where the new table begins - a device description and exactly same column names in the same order as before - and just continues parsing the CGM data. Let’s take a look at those whopping 51 Variables:</p>
<p>Looks pretty decent already. That’s a whole lotta <code>&lt;NA&gt;</code>s, though. We’ll have to look into that in another article.</p>
</section>
<section id="the-clean-up-procedure" class="level1">
<h1>The Clean-up Procedure</h1>
<p>Here’s what needs to be done still:</p>
<ul>
<li>clean up the column names</li>
<li>throw out the variables we don’t need (spoiler: most of them)</li>
<li><code>time</code> precision by minutes should suffice</li>
<li>a combined <code>datetime</code> column would be nice</li>
<li>a column of weekdays, too, just for some quality of life improvement</li>
</ul>
<p>It also totally makes sense to split pump from CGM data, of course. Since both are structurally identical, though, we’ll do that after the clean-up. At this point, we’re also only interested in variables that directly deal with glucose measurements, insulin dosage and carbohydrate intake<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<section id="codebook" class="level2">
<h2 class="anchored" data-anchor-id="codebook">Codebook</h2>
<p>The variables of interest are:</p>
<div class="fullwidth">
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 69%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Renamed to</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Index</code></td>
<td><code>index</code></td>
<td>kinda self-explanatory</td>
</tr>
<tr class="even">
<td><code>Date</code></td>
<td><code>date</code></td>
<td>Year-Month-Day</td>
</tr>
<tr class="odd">
<td><code>Time</code></td>
<td><code>time</code></td>
<td>hh:mm:ss</td>
</tr>
<tr class="even">
<td><code>BG Reading (mg/dL)</code></td>
<td><code>bg_direct</code></td>
<td>a <strong>direct</strong> measurement of blood, usually by pricking a finger</td>
</tr>
<tr class="odd">
<td><code>Sensor Glucose (mg/dL)</code></td>
<td><code>bg_sensor</code></td>
<td>an <em>indirect</em> measurement of interstitial fluid by the gcm sensor</td>
</tr>
<tr class="even">
<td><code>Basal Rate (U/h)</code></td>
<td><code>basal_rate</code></td>
<td>the hourly rate of insulin given (in ‘Units’; roughly 100U/ml)</td>
</tr>
<tr class="odd">
<td><code>BWZ BG Input (mg/dL)</code></td>
<td><code>wiz_bg</code></td>
<td>blood glucose level (manual input)</td>
</tr>
<tr class="even">
<td><code>BWZ Carb Input (grams)</code></td>
<td><code>wiz_carbs</code></td>
<td>carbohydrates (manual input)</td>
</tr>
<tr class="odd">
<td><code>BWZ Carb Ratio (g/U)</code></td>
<td><code>wiz_ratio</code></td>
<td>ratio of carbs per unit of insulin</td>
</tr>
<tr class="even">
<td><code>BWZ Correction Estimate (U)</code></td>
<td><code>wiz_est_correction</code></td>
<td>insulin to deliver to correct for too high bg level</td>
</tr>
<tr class="odd">
<td><code>BWZ Food Estimate (U)</code></td>
<td><code>wiz_est_food</code></td>
<td>insulin units to deliver for the amount of carbohydrates (carbs / ratio)</td>
</tr>
<tr class="even">
<td><code>BWZ Unabsorbed Insulin Total (U)</code></td>
<td><code>wiz_est_unabsorbed</code></td>
<td>insulin to <em>not</em> deliver in order to not overcompensate</td>
</tr>
<tr class="odd">
<td><code>Final Bolus Estimate</code></td>
<td><code>bolus_final</code></td>
<td>amount of insulin to deliver</td>
</tr>
<tr class="even">
<td><code>Bolus Volume Delivered (U)</code></td>
<td><code>bolus_delivered</code></td>
<td>the actual amount of insulin delivered</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="cleaning-and-variable-selection" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-and-variable-selection">Cleaning and Variable Selection</h2>
<p>To clean up column names, we could of course use some convenient helper function like <code>clean_names()</code> from the <code>janitor</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">clean_names</span>(data_raw) <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "alarm"                               "basal_rate_u_h"                     
 [3] "bg_reading_mg_d_l"                   "bg_source"                          
 [5] "ble_network_device"                  "bolus_cancellation_reason"          
 [7] "bolus_duration_h_mm_ss"              "bolus_number"                       
 [9] "bolus_source"                        "bolus_type"                         
[11] "bolus_volume_delivered_u"            "bolus_volume_selected_u"            
[13] "bwz_active_insulin_u"                "bwz_bg_input_mg_d_l"                
[15] "bwz_carb_input_grams"                "bwz_carb_ratio_g_u"                 
[17] "bwz_correction_estimate_u"           "bwz_estimate_u"                     
[19] "bwz_food_estimate_u"                 "bwz_insulin_sensitivity_mg_d_l_u"   
[21] "bwz_status"                          "bwz_target_high_bg_mg_d_l"          
[23] "bwz_target_low_bg_mg_d_l"            "bwz_unabsorbed_insulin_total_u"     
[25] "date"                                "event_marker"                       
[27] "final_bolus_estimate"                "index"                              
[29] "insulin_action_curve_time"           "isig_value"                         
[31] "linked_bg_meter_id"                  "network_device_associated_reason"   
[33] "network_device_disassociated_reason" "network_device_disconnected_reason" 
[35] "new_device_time"                     "preset_bolus"                       
[37] "preset_temp_basal_name"              "prime_type"                         
[39] "prime_volume_delivered_u"            "rewind"                             
[41] "scroll_step_size"                    "sensor_calibration_bg_mg_d_l"       
[43] "sensor_calibration_rejected_reason"  "sensor_exception"                   
[45] "sensor_glucose_mg_d_l"               "suspend"                            
[47] "temp_basal_amount"                   "temp_basal_duration_h_mm_ss"        
[49] "temp_basal_type"                     "time"                               
[51] "x51"                                </code></pre>
</div>
</div>
<p>As you can see, that does indeed make them “workable”, but it’s still pretty convoluted and even occasionally confusing. Therefore, in a second step, we do some touch-ups manually and get rid of all the columns we’re not interested in. And since we’re already at it, why not tick off the rest of the items on our list, too?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_full <span class="ot">&lt;-</span> data_raw <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> index,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">round_date</span>(<span class="fu">ymd_hms</span>(<span class="fu">paste</span>(date, time)), <span class="at">unit =</span> <span class="st">"minute"</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date  =</span> date,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">wday  =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">week_start =</span> <span class="dv">1</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">time  =</span> time,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">basal_rate =</span> basal_rate_u_h,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg_direct  =</span> bg_reading_mg_d_l,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg_sensor  =</span> sensor_glucose_mg_d_l,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_ratio =</span> bwz_carb_ratio_g_u,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_carbs =</span> bwz_carb_input_grams,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_bg =</span> bwz_bg_input_mg_d_l,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_est_correction =</span> bwz_correction_estimate_u,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_est_food =</span> bwz_food_estimate_u,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_est_unabsorbed =</span> bwz_unabsorbed_insulin_total_u,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">bolus_final =</span> final_bolus_estimate, </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">bolus_delivered =</span> bolus_volume_delivered_u</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 2 failed to parse.</code></pre>
</div>
</div>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p>Another <strong>Warning</strong>, this time a parsing failure? Most certainly either when calling for the weekday labels or concoctenating and rounding the datetime:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anyNA</span>(data_full<span class="sc">$</span>wday)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data_full <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(wday)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2
Columns: 16
$ index              &lt;dbl&gt; NA, NA
$ datetime           &lt;dttm&gt; NA, NA
$ date               &lt;date&gt; NA, NA
$ wday               &lt;ord&gt; NA, NA
$ time               &lt;time&gt; NA, NA
$ basal_rate         &lt;dbl&gt; NA, NA
$ bg_direct          &lt;dbl&gt; NA, NA
$ bg_sensor          &lt;dbl&gt; NA, NA
$ wiz_ratio          &lt;dbl&gt; NA, NA
$ wiz_carbs          &lt;dbl&gt; NA, NA
$ wiz_bg             &lt;dbl&gt; NA, NA
$ wiz_est_correction &lt;dbl&gt; NA, NA
$ wiz_est_food       &lt;dbl&gt; NA, NA
$ wiz_est_unabsorbed &lt;dbl&gt; NA, NA
$ bolus_final        &lt;dbl&gt; NA, NA
$ bolus_delivered    &lt;dbl&gt; NA, NA</code></pre>
</div>
</div>
<p>Two completely empty rows alright. Since even the <code>index</code> column is empty, it’s probably just an artefact of the “two datasets in one file issue”. We better check that out, too, though.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Find Suspects</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Glimpse</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anyNA</span>(data_raw<span class="sc">$</span>Index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">is.na</span>(data_raw<span class="sc">$</span>Index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4337 4338</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_raw[<span class="dv">4336</span><span class="sc">:</span><span class="dv">4339</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4
Columns: 51
$ Index                                 &lt;dbl&gt; 4335, NA, NA, 4336
$ Date                                  &lt;date&gt; 2022-01-30, NA, NA, 2022-02-17
$ Time                                  &lt;time&gt; 23:50:04,       NA,       NA, 11…
$ `New Device Time`                     &lt;lgl&gt; NA, NA, NA, NA
$ `BG Source`                           &lt;chr&gt; NA, "-------", "BG Source", NA
$ `BG Reading (mg/dL)`                  &lt;dbl&gt; NA, NA, NA, NA
$ `Linked BG Meter ID`                  &lt;chr&gt; NA, NA, "Linked BG Meter ID", NA
$ `Basal Rate (U/h)`                    &lt;dbl&gt; NA, NA, NA, NA
$ `Temp Basal Amount`                   &lt;lgl&gt; NA, NA, NA, NA
$ `Temp Basal Type`                     &lt;lgl&gt; NA, NA, NA, NA
$ `Temp Basal Duration (h:mm:ss)`       &lt;lgl&gt; NA, NA, NA, NA
$ `Bolus Type`                          &lt;chr&gt; NA, NA, "Bolus Type", NA
$ `Bolus Volume Selected (U)`           &lt;dbl&gt; NA, NA, NA, NA
$ `Bolus Volume Delivered (U)`          &lt;dbl&gt; NA, NA, NA, NA
$ `Bolus Duration (h:mm:ss)`            &lt;lgl&gt; NA, NA, NA, NA
$ `Prime Type`                          &lt;chr&gt; NA, NA, "Prime Type", NA
$ `Prime Volume Delivered (U)`          &lt;dbl&gt; NA, NA, NA, NA
$ Alarm                                 &lt;chr&gt; NA, NA, "Alarm", NA
$ Suspend                               &lt;chr&gt; NA, NA, "Suspend", NA
$ Rewind                                &lt;lgl&gt; NA, NA, NA, NA
$ `BWZ Estimate (U)`                    &lt;dbl&gt; NA, NA, NA, NA
$ `BWZ Target High BG (mg/dL)`          &lt;lgl&gt; NA, NA, NA, NA
$ `BWZ Target Low BG (mg/dL)`           &lt;lgl&gt; NA, NA, NA, NA
$ `BWZ Carb Ratio (g/U)`                &lt;dbl&gt; NA, NA, NA, NA
$ `BWZ Insulin Sensitivity (mg/dL/U)`   &lt;lgl&gt; NA, NA, NA, NA
$ `BWZ Carb Input (grams)`              &lt;dbl&gt; NA, NA, NA, NA
$ `BWZ BG Input (mg/dL)`                &lt;dbl&gt; NA, NA, NA, NA
$ `BWZ Correction Estimate (U)`         &lt;dbl&gt; NA, NA, NA, NA
$ `BWZ Food Estimate (U)`               &lt;dbl&gt; NA, NA, NA, NA
$ `BWZ Active Insulin (U)`              &lt;lgl&gt; NA, NA, NA, NA
$ `BWZ Status`                          &lt;chr&gt; NA, NA, "BWZ Status", NA
$ `Sensor Calibration BG (mg/dL)`       &lt;dbl&gt; NA, NA, NA, NA
$ `Sensor Glucose (mg/dL)`              &lt;dbl&gt; NA, NA, NA, 122
$ `ISIG Value`                          &lt;dbl&gt; NA, NA, NA, 23.9
$ `Event Marker`                        &lt;chr&gt; NA, NA, "Event Marker", NA
$ `Bolus Number`                        &lt;dbl&gt; NA, NA, NA, NA
$ `Bolus Cancellation Reason`           &lt;lgl&gt; NA, NA, NA, NA
$ `BWZ Unabsorbed Insulin Total (U)`    &lt;dbl&gt; NA, NA, NA, NA
$ `Final Bolus Estimate`                &lt;dbl&gt; NA, NA, NA, NA
$ `Scroll Step Size`                    &lt;chr&gt; NA, NA, "Scroll Step Size", NA
$ `Insulin Action Curve Time`           &lt;lgl&gt; NA, NA, NA, NA
$ `Sensor Calibration Rejected Reason`  &lt;lgl&gt; NA, NA, NA, NA
$ `Preset Bolus`                        &lt;lgl&gt; NA, NA, NA, NA
$ `Bolus Source`                        &lt;chr&gt; NA, NA, "Bolus Source", NA
$ `BLE Network Device`                  &lt;lgl&gt; NA, NA, NA, NA
$ `Network Device Associated Reason`    &lt;lgl&gt; NA, NA, NA, NA
$ `Network Device Disassociated Reason` &lt;lgl&gt; NA, NA, NA, NA
$ `Network Device Disconnected Reason`  &lt;lgl&gt; NA, NA, NA, NA
$ `Sensor Exception`                    &lt;chr&gt; NA, NA, "Sensor Exception", NA
$ `Preset Temp Basal Name`              &lt;lgl&gt; NA, NA, NA, NA
$ ...51                                 &lt;lgl&gt; NA, NA, NA, NA</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>That confirms it. Actually, we should throw those lines out right at the beginning of the process.</p>
</section>
<section id="wrap-up" class="level2">
<h2 class="anchored" data-anchor-id="wrap-up">Wrap-Up</h2>
<p>Doing it all in one go might then look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>data_full <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/sugr/carelink-export-220217.csv"</span>, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">delim =</span> <span class="st">";"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">Date =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">"%Y/%m/%d"</span>), </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Time =</span> <span class="fu">col_time</span>(<span class="at">format =</span> <span class="st">"%H:%M:%S"</span>)), </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>), </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">trim_ws =</span> <span class="cn">TRUE</span>, <span class="at">skip =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">index              =</span> index,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime_rounded   =</span> <span class="fu">round_date</span>(<span class="fu">ymd_hms</span>(<span class="fu">paste</span>(date, time)), <span class="at">unit =</span> <span class="st">"minute"</span>),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime           =</span> <span class="fu">ymd_hms</span>(<span class="fu">paste</span>(date, time)),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">date               =</span> date,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">wday               =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">week_start =</span> <span class="dv">1</span>),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">time               =</span> time,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">basal_rate         =</span> basal_rate_u_h,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg_direct          =</span> bg_reading_mg_d_l,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg_sensor          =</span> sensor_glucose_mg_d_l,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_ratio          =</span> bwz_carb_ratio_g_u,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_carbs          =</span> bwz_carb_input_grams,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_bg             =</span> bwz_bg_input_mg_d_l,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_est_correction =</span> bwz_correction_estimate_u,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_est_food       =</span> bwz_food_estimate_u,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">wiz_est_unabsorbed =</span> bwz_unabsorbed_insulin_total_u,</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">bolus_final        =</span> final_bolus_estimate, </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">bolus_delivered    =</span> bolus_volume_delivered_u</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="splitting-cgm-pump-data" class="level1 page-columns page-full">
<h1>Splitting CGM &amp; Pump Data</h1>
<p>Now that the whole thing is cleaned up the only thing left to do is splitting pump and sensor data into seperate dataframes. We could of course leave it as is, but a split brings some advantages. The CGM is not in sync with the (semi-manual) pump data; while the former happens very much exactly every 5 minutes<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, the latter just happens whenever. Additionally, at the initial reading of the data we already noticed the - professionally speaking - sheer insane amount of <code>NA</code>s, which we can drastically reduced by the split. When we color every cell of the data by whether it contains a value or not, it looks like this:</p>
<div class="cell page-columns page-full">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data_full <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_df</span>(is.na) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_df</span>(<span class="cf">function</span>(.){<span class="fu">ifelse</span>(., <span class="st">"&lt;NA&gt;"</span>, <span class="st">"not &lt;NA&gt;"</span>)}) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row_num =</span> <span class="fu">length</span>(index) <span class="sc">-</span> <span class="fu">seq_along</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>row_num,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"col"</span>, </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_transform =</span> as_factor,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"na"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(col, row_num, <span class="at">fill =</span> na)) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#ff3300"</span>,<span class="st">"#00cc00"</span>)) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-body">
<p><img src="sugr-prep_files/figure-html/b3_viz_na-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>That’s a lot of unused tabular real estate, what a waste… We can clearly see where pump data ends and CGM data begins, though. The ‘green block’ on the left hand side naturally consists of the timedate and indexing columns. We can also see that there are still otherwise empty rows in the lower part (the CGM data). There are two approaches by which to split the thing: (1) simply <code>filter</code> the <code>bg_sensor</code> column by checking for <code>NA</code> values and conveniently drop the empty CGM rows, too, or (2) use the previously identified index-row, such that those empty rows are kept and can be used to further investigate whats going on there<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. For the sake of thoroughness, let’s go with Option 2, have a look at what’s going on there and possibly remove those empty rows later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cutoff_idx <span class="ot">&lt;-</span> data_full<span class="sc">$</span>index[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(data_full<span class="sc">$</span>bg_sensor)))]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>cgm <span class="ot">&lt;-</span> data_full <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(index <span class="sc">&gt;</span> cutoff_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index, datetime, date, wday, time, bg_sensor)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>pump <span class="ot">&lt;-</span> data_full <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(index <span class="sc">&lt;=</span> cutoff_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>bg_sensor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cgm <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(is.na) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="cf">function</span>(.){<span class="fu">ifelse</span>(., <span class="st">"&lt;NA&gt;"</span>, <span class="st">"not &lt;NA&gt;"</span>)}) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row_num =</span> <span class="fu">length</span>(index) <span class="sc">-</span> <span class="fu">seq_along</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>row_num,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"col"</span>, </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_transform =</span> as_factor,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"na"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(col, row_num, <span class="at">fill =</span> na)) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#ff3300"</span>,<span class="st">"#00cc00"</span>)) <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>pump <span class="sc">%&gt;%</span> </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(is.na) <span class="sc">%&gt;%</span> </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="cf">function</span>(.){<span class="fu">ifelse</span>(., <span class="st">"&lt;NA&gt;"</span>, <span class="st">"not &lt;NA&gt;"</span>)}) <span class="sc">%&gt;%</span> </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row_num =</span> <span class="fu">length</span>(index) <span class="sc">-</span> <span class="fu">seq_along</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>row_num,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"col"</span>, </span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_transform =</span> as_factor,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"na"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(col, row_num, <span class="at">fill =</span> na)) <span class="sc">+</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#ff3300"</span>,<span class="st">"#00cc00"</span>)) <span class="sc">+</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sugr-prep_files/figure-html/b3_split_plot-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">CGM Data</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sugr-prep_files/figure-html/b3_split_plot-2.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Pump Data</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Well, better. There’s still room for improvement, especially regarding the pump data: Lots of small bolus deliveries (the last column) not accompanied by any other action, which we could further split up, for example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>wiz <span class="ot">&lt;-</span> pump <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>bolus_delivered) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">if_all</span>(basal_rate<span class="sc">:</span>bolus_final, is.na))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>bolus <span class="ot">&lt;-</span> pump <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index<span class="sc">:</span>time, bolus_delivered) <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bolus_delivered))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>wiz <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(is.na) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="cf">function</span>(.){<span class="fu">ifelse</span>(., <span class="st">"&lt;NA&gt;"</span>, <span class="st">"not &lt;NA&gt;"</span>)}) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row_num =</span> <span class="fu">length</span>(index) <span class="sc">-</span> <span class="fu">seq_along</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>row_num,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"col"</span>, </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_transform =</span> as_factor,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"na"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(col, row_num, <span class="at">fill =</span> na)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#ff3300"</span>,<span class="st">"#00cc00"</span>)) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>bolus <span class="sc">%&gt;%</span> </span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(is.na) <span class="sc">%&gt;%</span> </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="cf">function</span>(.){<span class="fu">ifelse</span>(., <span class="st">"&lt;NA&gt;"</span>, <span class="st">"not &lt;NA&gt;"</span>)}) <span class="sc">%&gt;%</span> </span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row_num =</span> <span class="fu">length</span>(index) <span class="sc">-</span> <span class="fu">seq_along</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>row_num,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"col"</span>, </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_transform =</span> as_factor,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"na"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(col, row_num, <span class="at">fill =</span> na)) <span class="sc">+</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#00cc00"</span>, <span class="st">"#ff3300"</span>)) <span class="sc">+</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sugr-prep_files/figure-html/b3_splitterer_plot-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Wizard Data</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sugr-prep_files/figure-html/b3_splitterer_plot-2.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Bolus Delivery Data</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>mostly hard-coded things like ratios or target values that change slightly during a day but stay the same across all days<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>other variables contain aforementioned “hard codings” or diagnostics on device usage such as low battery warnings<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>with an unspecific shift happening once a week whenever the sensor has to be replaced<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Actually, a third possibility is the extraction of only those empty rows within the CGM block, but losing the context in which they appear is not very practical.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/https:\/\/tobiasanton\.eu/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">— All Rites Reversed. Beware of Sleestak! —</div>
  </div>
</footer>



<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>